<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>View a fullscreen map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.18.0/mapbox-gl.js'></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mapbox-gl/0.45.0/mapbox-gl.js"></script>
    <!-- the jquery to save the day -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
<!-- need a leaflet cdn for leaflet functions  -->
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.42.0/mapbox-gl.css' rel='stylesheet' />

</head>
<body>
<div id='map'></div>

<script>
mapboxgl.accessToken =  '<%=ENV['mapbox'] %>';

var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/mapbox/outdoors-v9', //stylesheet location
    center: [-75.206876, 39.950782], // starting position
    zoom: 13 // starting zoom
});

map.addControl(new mapboxgl.FullscreenControl());
map.on('load', function() {


// add geojson source to mapbox
var  geojson = 'https://opendata.arcgis.com/datasets/113771ce9fa0424a8b529de9b74b1bc4_0.geojson';
console.log("geojson",geojson); 

// add geojson layer to mapbox
var ltsgeoJSON = $.ajax({
    url: 'https://opendata.arcgis.com/datasets/113771ce9fa0424a8b529de9b74b1bc4_0.geojson'
    }).done(function(response){

        console.log("response",response);
        console.log("response.features[0]",response.features[0]);

            // Add a new source from our GeoJSON data 
             map.addSource("myData1",{
                 type:"geojson",
                 data: response
             });
            //trying to add more sources to speed up render time  
            //map.addSource("myData2", {
            //     type: "geojson",
            //     data: response[1]
            // });

            // Create layer from source
              map.addLayer({
                "id": "layer",
                "type": "line",
                "source": "myData1",
                "layout": {
                    "visibility": "visible",
                    "line-join": "round",
                    "line-cap": "round"
                },
              //   "paint": {
              //       "line-color": "#cc2d45",
                    // "line-width": 8
              //   }
                
            });
            //   map.addLayer({
            //     "id": "geolayer2",
            //     "type": "line",
            //     "source": "myData2",
            //     "layout": {
            //         "visibility": "visible",
            //         "line-join": "round",
            //         "line-cap": "round"
            //     },
            //     "paint": {
            //         "line-color": "#2ECC71",
            //         "line-width": 8
            //     }
                
            // })
        }) //onload
    console.log("works?");
    console.log("ltsgeoJSON",ltsgeoJSON);
    }); //lts done
    // ltsgeoJSON;
    
 // });//ends onload function






</script>

<!-- graphhopper -->



 <script src="https://cdn.jsdelivr.net/npm/graphhopper-js-api-client/dist/graphhopper-client.js"></script>
 

<div class="information">
<h1>Safe Ride</h1>
<div class="headsection">
    <p>This site allows bikers to find a safe bicycle route using the DVRPC Bicycle Level of Traffic Stress and Connectivity Analysis</p>
    <p>Based on this network, we will assign you a bike route that not only prioritizes the <a href="">most efficient path</a> but also considers the least stressful riding experience on the existing network.
        <h4>(<a href="">How do we do this?)</a></h4></p>
</div>
</div> <!-- end info div -->


<!-- <div id="mapid"></div>
 --><!-- Add jQuery -->
<!--     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
<!-- Leaflet Ajax CDN -->
<script type="text/javascript" src="
  https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

<script>
  window.onload = function() {

    var ghRouting = new GraphHopper.Routing({
      key: '<%= ENV['graphhopper']%>',
      vehicle: "bike",
      elevation: false
    });

    ghRouting.addPoint(new GHInput(39.9553278, -75.171741));
    ghRouting.addPoint(new GHInput(39.9497359, -75.2116433));

    ghRouting.doRequest()
      .then(function(json) {
        // Add your own result handling here
        console.log(json);
        var drawRoute = json;
        var routeCoordinates = drawRoute.paths[0].points.coordinates;
        
        console.log("routeCoordinates:",routeCoordinates);
      })
      .catch(function(err) {
        console.error(err.message);
      });



  };
</script>
</body>
</html>